{% extends 'base.html' %}
{% block content %}
<h3>Booking for: {{ booking.vehicle }}</h3>
<p><strong>Issue:</strong> {{ booking.get_issue_display|default:booking.issue }}</p>

<div id="map" style="height: 400px; width: 100%; margin: 20px 0;"></div>

<h4>Nearby Providers</h4>
<ul class="list-group">
    {% for provider in providers %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ provider }}
            <a href="{% url 'select_provider' booking.id provider.id %}" class="btn btn-success">Book This</a>
        </li>
    {% empty %}
        <li class="list-group-item">No providers available nearby.</li>
    {% endfor %}
</ul>

<script src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap" async defer></script>
<script>
function initMap() {
    const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 12,
        center: { lat: 20.5937, lng: 78.9629 }, // Default India center
    });

    // Add user location marker if available (via JS geolocation later)
    // Add provider markers
    {% for provider in providers %}
        new google.maps.Marker({
            position: { lat: {{ provider.location.point.y }}, lng: {{ provider.location.point.x }} },
            map: map,
            title: "{{ provider }}"
        });
    {% endfor %}
}
</script>
{% endblock %}